<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,aItemress=no">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/font-awesome/css/font-awesome.min.css" />
    <style>
    .image-item {
        position: relative;
        height: 5.3rem;
        overflow: hidden;
        background-color: #f0f0f0;
    }
    .image-item img {
        display: block;
        margin: 0 auto;
        width: auto;
        height: 100%;
    }
    .image-item .delete-btn {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 28px;
        height: 28px;
        background-color: rgba(0,0,0,0.7);
        margin-left: -14px;
        margin-top: -14px;
        color: #ffffff;
        text-align: center;
        border-radius: 50%;
    }
    </style>
</head>
<body>

  <section class="aui-content-padded">
<ul class="aui-list aui-form-list">
    <li class="aui-list-item">
        <div class="aui-list-item-inner">
            <div class="aui-list-item-label">
                标题
            </div>
            <div class="aui-list-item-input">
                <input id="Title" type="text" placeholder="" readonly>
            </div>
        </div>
    </li>
  </ul>
</section>
  <section class="aui-content-padded">
    <textarea id="Content" style="height:8em;overflow-y:scroll;background-color:#ffffff;" placeholder="" readonly ></textarea>
  </section>


    <section  class="aui-content-padded">
      <div id="noticeImageContent"  class="aui-row aui-row-padded">
      </div>
    </section>
<section class="aui-content-padded">
    <ul class="aui-list aui-form-list">
      <li class="aui-list-item">
          <div class="aui-list-item-inner">
              <div class="aui-list-item-label">
                  项目地址
              </div>

              <div class="aui-list-item-input">
                    <input  id="Address" placeholder="" type="text" readonly>
              </div>
          </div>
      </li>
    </ul>
</section>
    <script id="noticeImageTpl" type="text/html">

        {{each list}}

        <div  class="aui-col-xs-4 image-item" onclick="ImageApi.openImageBrowser(['{{$value[1]}}']);">
            <image src="{{$value[1]}}" class="notes-image"   />
        </div>

        {{/each}}
    </script>

    <script id="commentTpl" type="text/html">
      <hr class="aui-hr "/>
      {{each list}}
      <div class="aui-row  aui-padded-r-5" >
        <div class="aui-col-xs-2 " style="height:80px">
          <div align="center"><img src="{{$value[2]}}" class="aui-img-round"   style="height:40px;width:40px;display:inline-block" /></div>
          <div class="aui-text-center" style="width:100%">{{$value[3]}}</div>
        </div>
        <div class="aui-col-xs-10 aui-text-left aui-padded-15"  style="height:100px">
          {{$value[4]}}
        </div>
      </div>
      <hr class="aui-hr "/>
      {{/each}}
      </script>


      <!-- <div id="footDiv" >
      <div id="spanFoot" style="line-height:2.2rem">&nbsp;</div>
          <footer id="footer" class="aui-bar aui-bar-tab aui-border-t">
                  <div class="aui-bar-tab-item aui-padded-l-15 aui-padded-r-15" tapmode style="width: auto;">
                      <div class="search-input aui-font-size-14">
                            <input  id="CommectContent" placeholder="请输入评论内容" type="text" >
                      </div>
                  </div>
                  <div class="aui-bar-tab-item aui-font-size-14" tapmode  style="width: 2.2rem;" onclick="saveComment();">
                      发送
                  </div>
              </footer>
            </div> -->
</body>
<script type="text/javascript" src="../../script/api.js" ></script>
<script type="text/javascript" src="../../css/amazeui/js/jquery.min.js"></script>
<script type='text/javascript' src='../../script/common.js'></script>
<script type='text/javascript' src='../../script/queryapi.js'></script>
<script type='text/javascript' src='../../script/template.js'></script>
<script type="text/javascript" src="../../script/imageapi.js"></script>
<script type="text/javascript" src="../../script/aui-tab.js"></script>
<script type="text/javascript">

    apiready = function(){
        api.parseTapmode();

        var height = $("#footer").height();
        $('#spanFoot').css('line-height', height+"px");

        if(api.pageParam.tellTechId && api.pageParam.tellTechId!=""){
            loadEntity(api.pageParam.tellTechId);
            loadImages(api.pageParam.tellTechId);
            //loadCommects();
        }
    }

    function loadEntity(id){
      AjaxApi.rest("retrievEntity","SiteTellTech",id,function(data){
            $("#Title").val(data.Title);
            $("#Content").val(data.Content);
            $("#Address").val(data.Address);

        });
    }

    function preImageUrl(datalist)
    {
      var picIndex = 1;
        for (var i = 0; i < datalist.length; i++) {
          var item = datalist[i];
          if(item[picIndex] && item[picIndex]!=""){
            item[picIndex] = ImageApi.getImageUrl(item[0],item[picIndex]);
          }else{
            item[picIndex]="image/project.jpg";
          }
        }
    }

    function loadImages(ownerId){
      AjaxApi.query("query_1006",{"OwnerId":ownerId},function(data){
          var datalist = data.list;
          if(datalist&& datalist.length>0){
            preImageUrl(datalist);
            var tplData = {
              "list" : datalist
            };
            var html = template("noticeImageTpl", tplData);
            $("#noticeImageContent").html(html);

          }
        });
    }

    function preUsermageUrl(datalist)
    {
      var userIdx = 1;
      var imageIdx = 2;
        for (var i = 0; i < datalist.length; i++) {
          var item = datalist[i];
          if(item[imageIdx] && item[imageIdx]!=""){
            item[imageIdx] = ImageApi.getGlobleImageUrl(item[userIdx],item[imageIdx]);
          }else{
            item[imageIdx]="../image/user.jpg";
          }
        }
    }

    // function loadCommects(){
    //     AjaxApi.query("query_1134",{"WorkReportId":api.pageParam.tellTechId},function(data){
    //         var datalist = data.list;
    //         if(datalist&& datalist.length>0){
    //           preUsermageUrl(datalist);
    //           var tplData = {
    //             "list" : datalist
    //           };
    //           var html = template("commentTpl", tplData);
    //           $("#commentContent").html(html);
    //
    //         }
    //       });
    //
    // }
    //
    // function saveComment(){
    //    if($("#CommectContent").val() == ""){
    //      return ;
    //    }
    //
    //     var ownerId = GetUuid();
    //     var entObj = {"Id":ownerId,
    //           "WorkReportId":api.pageParam.tellTechId,
    //           "Content":$("#CommectContent").val(),
    //           "ProjectId":TServerInfo.getProjectId(),
    //           "UserId":TServerInfo.getUserId()
    //         };
    //
    //     AjaxApi.rest("createEntity","OaWorkReportComment",entObj,function(data){
    //           $("#CommectContent").val("");
    //           loadCommects();
    //     });
    // }


</script>
</html>
