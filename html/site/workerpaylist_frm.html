<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../css/app.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui-pull-refresh.css" />
    <style type="text/css">
    .am-with-fixed-tab {
      padding-top: 0rem;
    }
    </style>
</head>
<body class="am-with-fixed-tab">
  <div id="header" class="am-header-fixed">

  </div>

    <section class="aui-refresh-content">
      <ul id="workerPayContent" name="workerPayTabContent" class="aui-list aui-media-list" style="background-color:#f5f5f5">
<br/>  <br/><br/><br/><br/><br/><br/>  <br/><br/><br/><br/><br/>
      </ul>
    </section>


    <script id="workerPayTpl" type="text/html">

        {{each list}}

        <li class="aui-list-item aui-list-item-middle" style="background-color:#ffffff;min-height:0px" >
            <div class="aui-row aui-list-item-text aui-font-size-12 aui-padded-t-5 aui-padded-b-5 " >
              <div class="aui-col-xs-3 aui-text-center">{{$value[1]}} </div>
              <div class="aui-col-xs-3 aui-text-right">{{$value[2]}} </div>
              <div class="aui-col-xs-3 aui-text-center">{{$value[3]}}</div>
              <div class="aui-col-xs-3 aui-text-center">{{$value[4]}}</div>
            </div>
        </li>

        {{/each}}
    </script>

    <script id="workerPayHeaderTpl" type="text/html">
      <li class="aui-list-item aui-list-item-middle" style="min-height:0px">
        <div class="aui-row aui-list-item-text aui-font-size-14 " >
          <div class="aui-col-xs-3 aui-text-center">日期 </div>
          <div class="aui-col-xs-3 aui-text-right">金额</div>
          <div class="aui-col-xs-3 aui-text-center">备注</div>
          <div class="aui-col-xs-3 aui-text-center">记录人</div>
        </div>
      </li>
    </script>


    <footer class="aui-bar aui-bar-tab aui-margin-b-15" id="footer" style="background-color:rgba(0,0,0,0);">
      <div class="aui-row aui-list-item-text aui-font-size-14 " >
        <div class="aui-col-xs-6 aui-text-center">
          <div class="aui-btn aui-btn-warning " style="width:8em" onclick="payOneWorker('借款')">借款</div>
        </div>
        <div class="aui-col-xs-6 aui-text-center">
          <div class="aui-btn aui-btn-primary " style="width:8em" onclick="payOneWorker('工资')">发工资</div>
        </div>
      </div>
   </footer>
</body>
<script type="text/javascript" src="../../script/api.js" ></script>
<script type="text/javascript" src="../../css/amazeui/js/jquery.min.js"></script>
<script type='text/javascript' src='../../script/common.js'></script>
<script type='text/javascript' src='../../script/queryapi.js'></script>
<script type='text/javascript' src='../../script/template.js'></script>
<script type="text/javascript" src="../../script/aui-pull-refresh.js"></script>
<script type="text/javascript" src="../../script/aui-scroll.js" ></script>
<script type='text/javascript' src='../../script/controls.js'></script>
<script type="text/javascript" src="../../script/aui-tab.js"></script>
<script type="text/javascript">

var tab;

var pageComp = new PageComponent(0,10,loadworkerPays);

apiready = function () {

  var height = $("#header").height();
  $('body').css('padding-top', height+1);

  initPull();
  initPullBottom();
  loadworkerPayData()
}

function initPull(){
  var pullRefresh = new auiPullToRefresh({
    container: document.querySelector('.aui-refresh-content'),
    triggerDistance: 100
},function(ret){
    if(ret.status=="success"){
      loadworkerPayData();
      setTimeout(function(){
        pullRefresh.cancelLoading(); //刷新成功后调用此方法隐藏
      },1500);
    }
})
}

function loadData(){
  loadworkerPayData();
}

function loadworkerPayData(){
  pageComp.load();
}

function loadMoreworkerPayData(){
  pageComp.loadMore();
}

function initPullBottom(){
  var scroll = new auiScroll({
          listen:true,
          distance:5 //判断到达底部的距离，isToBottom为true
      },function(ret){
          if(ret.isToBottom){
            loadMoreworkerPayData();
            //alert("已到达底部");
              //document.getElementById("demo").textContent = "已到达底部";
          }else{
              //document.getElementById("demo").textContent = "滚动高度："+ret.scrollTop;

          }

      });

}

function loadworkerPays(pagecomp){
    pagecomp.setLoadState(true);
    var param = $.extend(pagecomp.getPageParam(),TServerInfo.getProjUserParam());
    param["WorkerId"] = api.pageParam.workerId;

    AjaxApi.query("query_2013",param,function(data){
      if(data.total) pagecomp.setTotal(data.total);

      var datalist = data.list;
      if(datalist){
        var tplData = {
          "list" : datalist
        };
        var html = template("workerPayTpl", tplData);
        var header =template("workerPayHeaderTpl",{});

        if(pagecomp.getIsAppend()){
          $("#workerPayContent").append(html);
        }else{
          $("#workerPayContent").html(header+html);
        }
      }
      pagecomp.setLoadState(false);

    //  AjaxApi.getredpoint("SiteworkerInfo",0);
    });
}

function payOneWorker(payType){
  api.openWin({
                name: "workerpayonecurd_win",
                url: "workerpayonecurd_win.html",
                pageParam: {
                    isFrame: false,
                    workerId:api.pageParam.workerId,
                    workerName:api.pageParam.workerName,
                    payType:payType
                },
                bgColor: '#FFFFFF',
                slidBackEnabled: false,
                vScrollBarEnabled:false,
                hScrollBarEnabled:false,
                delay: 0
            }
    );
}

function editWorkerPay(id){

  // api.openWin({
  //               name: "workerinfocurd_win",
  //               url: "workerinfocurd_win.html",
  //               pageParam: {
  //                   isFrame: false,
  //                   workerInfoId:id
  //               },
  //               bgColor: '#FFFFFF',
  //               slidBackEnabled: false,
  //               vScrollBarEnabled:false,
  //               hScrollBarEnabled:false,
  //               delay: 0
  //           }
  //   );
}



</script>
</html>
