<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title></title>
      <link rel="stylesheet" type="text/css" href="css/app.css" />
      <link rel="stylesheet" type="text/css" href="css/aui.css" />
      <link rel="stylesheet" type="text/css" href="css/aui-pull-refresh.css" />
      <style>
          body{

          }
          .am-with-fixed-custheader {
            padding-top: 3.25rem;
          }
      </style>
  </head>
  <body class="am-with-fixed-custheader aui-margin-l-0">
    <div id="header" class="am-header-fixed" >
    <header id="aui-header" class="aui-bar aui-bar-nav aui-bar-light  ">
      <a class="aui-btn aui-pull-left" tapmode onclick="closeWin()">
          <span class="aui-iconfont aui-icon-left"></span>
      </a>
    <div class="aui-title" >选择项目</div>
    </header>
  </div>

<section class="aui-refresh-content " >
    <ul id="projectListContent" class="aui-list aui-media-list" style="background-color:#f5f5f5">

<br/>  <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
      </ul>
</section>

      <script id="projectListTpl" type="text/html">

          {{each list}}

          <li class="aui-list-item aui-list-item-middle" style="background-color:#ffffff;" onclick="selectProject('{{$value[0]}}','{{$value[1]}}',{{$value[3]}},{{$value[4]}});">
            <div class="aui-media-list-item-inner">
              <div class="aui-list-item-media" style="width:auto">
                  <img src=" {{$value[2]}}" style="height:40px;width:40px" class="aui-img-round" />
              </div>
              <div class="aui-list-item-inner">
                <div class="aui-list-item-title">{{$value[1]}}  </div>
              </div>
              </div>
          </li>

          {{/each}}
      </script>
  </body>
  <script type="text/javascript" src="script/api.js" ></script>
  <script type="text/javascript" src="css/amazeui/js/jquery.min.js"></script>
  <script type='text/javascript' src='script/common.js'></script>
  <script type='text/javascript' src='script/queryapi.js'></script>
  <script type='text/javascript' src='script/template.js'></script>
  <script type="text/javascript" src="script/imageapi.js"></script>
  <script type="text/javascript" src="script/aui-pull-refresh.js"></script>
  <script type="text/javascript">
  function closeWin(){
      api.closeWin({
      });
  }

      apiready = function(){
        var header = $api.byId('aui-header');
        $api.fixStatusBar(header);

        var height = $("#header").height();
        $('body').css('padding-top', height);

          initPull();

          loadProjects();
      };

      function initPull(){
        var pullRefresh = new auiPullToRefresh({
          container: document.querySelector('.aui-refresh-content'),
          triggerDistance: 100
      },function(ret){
          if(ret.status=="success"){
            loadProjects();
            setTimeout(function(){
              pullRefresh.cancelLoading(); //刷新成功后调用此方法隐藏
            },1500);
          }
      })
      }

      function preProImageUrl(datalist)
      {
        var picIndex = 2;
          for (var i = 0; i < datalist.length; i++) {
            var item = datalist[i];
            if(item[picIndex] && item[picIndex]!=""){
              item[picIndex] = ImageApi.getGlobleImageUrl(item[0],item[picIndex]);
            }else{
              item[picIndex]="image/project.jpg";
            }

          }
      }

      function loadProjects(){
          AjaxApi.query("query_1005",{"UserId":TServerInfo.getUserId()},function(data){
            var datalist = data.list;
            if(datalist){
              preProImageUrl(datalist);
              var tplData = {
                "list" : datalist
              };
              var html = template("projectListTpl", tplData);
              $("#projectListContent").html(html);

            }
          });
      }

      function selectProject(id,name,lon,lat){
        api.confirm({
            title: '提示',
            msg: '确定选择:'+name,
            buttons: ['确定', '取消']
          }, function(ret, err) {
            var index = ret.buttonIndex;
            if(index == 1){
              returnSelectProject(api.pageParam.srcWinName,api.pageParam.srcFrameName,id,name,lon,lat);
              api.closeWin();
            }
          });

      }
  </script>
  </html>
